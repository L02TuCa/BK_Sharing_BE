version: '3.8'

services:
  app:
    build: .
    ports:
      - "8080:8080"
    environment:
      # Supabase PostgreSQL Cloud Database
      - SPRING_DATASOURCE_URL=jdbc:postgresql://db.mdygwitoqcbfhxohuazt.supabase.co:5432/postgres?user=postgres&password=Lol0919442401&sslmode=require
      - SPRING_DATASOURCE_USERNAME=postgres
      - SPRING_DATASOURCE_PASSWORD=@Lol0919442401
      - SPRING_DATASOURCE_DRIVER_CLASS_NAME=org.postgresql.Driver
      
      # JPA Configuration
      - SPRING_JPA_HIBERNATE_DDL_AUTO=update
      - SPRING_JPA_PROPERTIES_HIBERNATE_DIALECT=org.hibernate.dialect.PostgreSQLDialect
      
      # Supabase Storage
      - SUPABASE_URL=https://mdygwitoqcbfhxohuazt.supabase.co
      - SUPABASE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1keWd3aXRvcWNiZmh4b2h1YXp0Iiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2NjY3NTgzNCwiZXhwIjoyMDgyMjUxODM0fQ.jLXUUKt9xgo5fvROxqOUlUX6c6x2uwmeNZ1-ILdviuU
      - SUPABASE_BUCKET=bk-docs
      
      # File Upload Limits
      - SPRING_SERVLET_MULTIPART_MAX_FILE_SIZE=50MB
      - SPRING_SERVLET_MULTIPART_MAX_REQUEST_SIZE=50MB
      
      # Disable Security (temporarily)
      - SPRING_AUTOCONFIGURE_EXCLUDE=org.springframework.boot.autoconfigure.security.servlet.SecurityAutoConfiguration
      
      # Server Port
      - SERVER_PORT=8080
      
      # Logging
      - LOGGING_LEVEL_APP_MOBILE_BK_SHARING=DEBUG
    # Health check for the app
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/api/health"]
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped

# No database service needed - using Supabase cloud
networks:
  app-network:
    driver: bridge